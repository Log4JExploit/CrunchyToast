/*
 * Copyright (c) 2024 CrunchyToast by Log4JExploit
 * Do you keep my non-compiled source code?
 * Then keep this comment.  (View the license)
 */

package github.log4jexploit.crunchytoast;

import github.log4jexploit.crunchytoast.http.endpoint.HttpArg;
import github.log4jexploit.crunchytoast.http.endpoint.HttpEndpoint;
import github.log4jexploit.crunchytoast.http.inbound.impl.HttpServerBuilder;
import github.log4jexploit.crunchytoast.http.inbound.inf.HttpServer;
import github.log4jexploit.crunchytoast.http.message.body.impl.BodyContentWriterChunked;
import github.log4jexploit.crunchytoast.http.message.inf.HttpRequest;
import github.log4jexploit.crunchytoast.http.message.inf.HttpResponse;
import github.log4jexploit.crunchytoast.http.util.Http;

import java.util.List;

import static github.log4jexploit.crunchytoast.http.endpoint.HttpArg.Type.REQUEST;

public class Main {

    public static void main(String[] args) {
        HttpServer server = HttpServerBuilder.build(1024, HttpServerBuilder.getDefault());
        server.getResourceManager().registerHandler(new Main());
        server.start();
    }

    @HttpEndpoint(uri = "/dev/link")
    public Object process(
            @HttpArg(type = REQUEST) HttpRequest request
    ){
        return "Kinks & Co 50% OFF!!";
    }

    @HttpEndpoint(uri = "/dev/link3")
    public Object process3(
            @HttpArg(type = REQUEST) HttpRequest request
    ){
        return List.of("Hey", "und", "so!");
    }

    @HttpEndpoint(uri = "/dev/link2")
    public Object processOther(
            @HttpArg(type = REQUEST) HttpRequest request
    ){
        HttpResponse response = HttpResponse.compose()
                .withCode(Http.ResponseCode.OK)
                .build();

        response.setChunkedTransfer(true);
        BodyContentWriterChunked writerChunked = (BodyContentWriterChunked) response.send(request.getClient());

        writerChunked.writeNextChunk("Data".getBytes());
        writerChunked.writeNextChunk("Data2".getBytes());
        writerChunked.writeNextChunk("Data3".getBytes());
        writerChunked.writeNextChunk("Data4".getBytes());
        writerChunked.onFlushRemaining();

        return response;
    }

}
