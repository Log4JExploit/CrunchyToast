/*
 * Copyright (c) 2024 CrunchyToast by Log4JExploit
 * Do you keep my non-compiled source code?
 * Then keep this comment.  (View the license)
 */

package github.log4jexploit.crunchytoast.cert;

import java.nio.file.Path;

public final class CertHelper {

    public static CertHelper.Builder using(CertManager certManager) {
        return new Builder(certManager);
    }

    public static class Builder {
        private final CertManager certManager;


        public Builder(CertManager certManager) {
            this.certManager = certManager;
        }

        public Builder withKeyPassword(String password) {
            certManager.setPrivateKeyPassword(password.toCharArray());
            return this;
        }

        public Builder withCertFile(String fileName) {
            certManager.setCertificateFile(fileName);
            return this;
        }

        public Builder withKeyFile(String fileName) {
            certManager.setPrivateKeyFile(fileName);
            return this;
        }

        public Builder withCertFolder(Path pathToFolder) {
            certManager.setCertificateFolder(pathToFolder);
            return this;
        }

        public Builder withLetsEncryptLinux(String domain) {
            String folder = "/etc/letsencrypt/live/"+domain;
            Path path = Path.of(folder);

            if(!path.toFile().exists())
                throw new RuntimeException("Path '"+folder+"' could not be resolved!");

            this.certManager.setCertificateFolder(path);
            this.certManager.setPrivateKeyFile("privkey.pem");
            this.certManager.setCertificateFile("fullchain.pem");
            this.certManager.setPrivateKeyPassword(new char[0]);
            return this;
        }
    }

}
