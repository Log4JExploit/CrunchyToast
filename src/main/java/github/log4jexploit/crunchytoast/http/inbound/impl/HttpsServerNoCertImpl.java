/*
 * Copyright (c) 2022-2024 CrunchyToast by Log4JExploit
 * Do you keep my non-compiled source code?
 * Then keep this comment.  (View the license)
 */

package github.log4jexploit.crunchytoast.http.inbound.impl;

import javax.net.ServerSocketFactory;
import javax.net.ssl.SSLServerSocketFactory;
import java.io.IOException;
import java.io.UncheckedIOException;
import java.net.InetAddress;

public class HttpsServerNoCertImpl extends HttpServer {

    private ServerSocketFactory factory;

    public HttpsServerNoCertImpl(int port) {
        super(port);
        init();
    }

    public HttpsServerNoCertImpl(int port, String bindingIP) {
        super(port, bindingIP);
        init();
    }

    private void init() {
        try {
            //SSLContext.setDefault(SSLContext.getInstance("TLSv1.3"));
            this.factory = SSLServerSocketFactory.getDefault();
        } catch (Exception e) {
            throw new UncheckedIOException(new IOException(e));
        }
    }

    @Override
    void createServerSocket() throws IOException {
        this.serverSocket = factory.createServerSocket(this.port, 0, InetAddress.getByName(this.getBindingIP()));
    }
}
