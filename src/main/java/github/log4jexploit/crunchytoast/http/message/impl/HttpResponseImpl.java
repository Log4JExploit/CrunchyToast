/*
 * Copyright (c) 2022-2025 CrunchyToast by Log4JExploit
 * Do you keep my non-compiled source code?
 * Then keep this comment.  (View the license)
 */

package github.log4jexploit.crunchytoast.http.message.impl;

import github.log4jexploit.crunchytoast.general.CommonText;
import github.log4jexploit.crunchytoast.http.message.body.inf.IBodyContentReader;
import github.log4jexploit.crunchytoast.http.message.body.inf.IBodyContentWriter;
import github.log4jexploit.crunchytoast.http.message.inf.HttpResponse;
import github.log4jexploit.crunchytoast.http.util.Http;
import github.log4jexploit.crunchytoast.server.Client;
import github.log4jexploit.crunchytoast.strategy.Strategy;
import github.log4jexploit.crunchytoast.strategy.StrategyResponseReceiveImpl;
import github.log4jexploit.crunchytoast.strategy.StrategyResponseSendImpl;


public final class HttpResponseImpl extends HttpMessageImpl implements HttpResponse {

    private Http.ResponseCode responseCode;
    private Strategy.Response strategy;


    public HttpResponseImpl() {
        responseCode = Http.ResponseCode.OK;
    }

    @Override
    public IBodyContentReader receive(Client client) {
        this.client = client;
        this.strategy = new StrategyResponseReceiveImpl();
        this.strategy.initialize(this.client, this);
        this.strategy.execute();
        return super.receive(this.client);
    }

    @Override
    public IBodyContentWriter send(Client client) {
        this.client = client;
        this.prepareSend();
        this.strategy = new StrategyResponseSendImpl();
        this.strategy.initialize(this.client, this);
        this.strategy.execute();
        return super.send(this.client);
    }

    private void prepareSend() {
        if(this.getServer() == null)
            this.setServer(CommonText.CRUNCHY_TOAST);
    }

    @Override
    public Http.ResponseCode getResponseCode() {
        return responseCode;
    }

    @Override
    public void setResponseCode(Http.ResponseCode responseCode) {
        this.responseCode = responseCode;
    }

    @Override
    public HttpResponseImpl clone() {
        HttpResponseImpl clone = new HttpResponseImpl();
        clone.setResponseCode(this.responseCode);
        clone.setContent(this.resource);

        clone.getHeaders().putAll(this.headers);
        clone.getCustomHeaders().putAll(this.customHeaders);
        clone.getTrailers().putAll(this.trailers);
        clone.getCustomTrailers().putAll(this.customTrailers);
        return clone;
    }
}
