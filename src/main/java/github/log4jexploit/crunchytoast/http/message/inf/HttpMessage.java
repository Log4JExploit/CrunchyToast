/*
 * Copyright (c) 2022-2025 CrunchyToast by Log4JExploit
 * Do you keep my non-compiled source code?
 * Then keep this comment.  (View the license)
 */

package github.log4jexploit.crunchytoast.http.message.inf;

import github.log4jexploit.crunchytoast.general.ClientFakeImpl;
import github.log4jexploit.crunchytoast.http.message.body.inf.IBodyContentHandler;
import github.log4jexploit.crunchytoast.http.message.body.inf.IBodyContentReader;
import github.log4jexploit.crunchytoast.http.message.body.inf.IBodyContentWriter;
import github.log4jexploit.crunchytoast.http.message.impl.HttpMessageImpl;
import github.log4jexploit.crunchytoast.http.util.Http;
import github.log4jexploit.crunchytoast.http.util.HttpSecurityPolicy;
import github.log4jexploit.crunchytoast.resource.Resource;
import github.log4jexploit.crunchytoast.server.Client;

import java.io.ByteArrayOutputStream;

public interface HttpMessage extends TrailerHandler, HttpHeaderSetters, Cloneable, HttpProtocol {

    IBodyContentWriter send(Client client);

    IBodyContentReader receive(Client client);

    void performChecks();

    void setContent(byte[] content);

    void setContent(byte[] content, Http.ContentType contentType);

    void setContent(Resource resource);

    void setSecurityPolicy(HttpSecurityPolicy securityPolicy);

    @Deprecated
    byte[] getContent();

    Resource getContentAsResource();

    Client getClient();

    HttpSecurityPolicy getSecurityPolicy();

    IBodyContentHandler getBodyContentHandler();

    boolean isSending();

    boolean isSendingComplete();

    HttpMessage clone();

    default void dump() {
        ByteArrayOutputStream buffer = new ByteArrayOutputStream();
        ClientFakeImpl client = new ClientFakeImpl(buffer, this.getSecurityPolicy());
        client.start();
        this.clone().send(client).onFlushRemaining();
        System.out.println("##### Dump Start #####");
        System.out.println(buffer);
        System.out.println("##### Dump Complete #####");
    }

    static HttpMessage createDefault() {
        return new HttpMessageImpl();
    }
}
